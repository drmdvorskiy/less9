scope: postgres
namespace: /db/
name: {{ ansible_hostname }}

restapi:
    listen: {{ ansible_enp0s8.ipv4.address }}:8008
    connect_address: {{ ansible_enp0s8.ipv4.address }}:8008

etcd:
    hosts: 192.168.6.3:2379

bootstrap:
    dcs:
        ttl: 30
        loop_wait: 10
        retry_timeout: 10
        maximum_lag_on_failover: 1048576
        postgresql:
            use_pg_rewind: true
            parameters:
                    archive_mode: 'on'
                    wal_level: replica
                    max_parallel_workers: 8
                    min_wal_size: 1GB
                    max_wal_size: 2GB
                    max_connections: 100

    initdb:
    - encoding: UTF8
    - data-checksums

    pg_hba:
    - host replication replicator 127.0.0.1/32 md5
    - host replication replicator 192.168.6.4/0 md5
    - host replication replicator 192.168.6.5/0 md5
    - host all all 0.0.0.0/0 md5

postgresql:
    listen: {{ ansible_enp0s8.ipv4.address }}:5432
    bin_dir: /usr/lib/postgresql/12/bin
    connect_address: {{ ansible_enp0s8.ipv4.address }}:5432
    data_dir: /data/patroni
    pgpass: /tmp/pgpass
    authentication:
        replication:
            username: replicator
            password: 'pass'
        superuser:
            username: postgres
            password: 'pass'

    parameters:
        unix_socket_directories: '.'
        log_checkpoints: 'on'
        log_duration: 'on'
        log_hostname: 'off'
        log_lock_waits: 'off'
        log_statement: 'ddl'
        log_temp_files: '0'
        log_timezone: 'UTC'
        log_parser_stats: 'off'
        log_panner_stats: 'off'
        log_executor_stats: 'off'
        log_statement_stats: 'off'

watchdog:
    mode: off

tags:
    nofailover: false
    noloadbalance: false
    clonefrom: false
    nosync: false
